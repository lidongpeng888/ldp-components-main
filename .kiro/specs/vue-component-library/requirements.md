# Vue 组件库需求文档

## 简介

该组件库基于 ant-design-vue 之上再封装，提供 17 个核心组件。**所有组件必须以 Ant Design Vue 组件为基础进行二次封装，不允许从零开始构建组件**。该库将支持多种集成方式，包括基于模板的使用和基于 hooks 的使用，每个组件都具有广泛的自定义选项。

## 核心技术约束

### Ant Design Vue 封装要求

**强制性要求：每个组件都必须基于 Ant Design Vue 的相应组件进行封装**

1. **基础组件映射**
   - 弹窗组件 → 基于 `a-modal` 封装
   - 查询面板组件 → 基于 `a-form` + `a-row` + `a-col` 封装
   - 数据表格组件 → 基于 `a-table` 封装
   - 表单组件 → 基于 `a-form` + `a-form-item` 封装
   - 文件上传组件 → 基于 `a-upload` 封装
   - 空状态组件 → 基于 `a-empty` 封装
   - 标签页组件 → 基于 `a-tabs` 封装
   - 加载组件 → 基于 `a-spin` 封装
   - 消息组件 → 基于 `a-message` + `a-notification` 封装
   - 选择器组件 → 基于 `a-select` + `a-tree-select` 封装
   - 级联选择器组件 → 基于 `a-cascader` 封装
   - 下拉菜单组件 → 基于 `a-dropdown` 封装
   - 图片懒加载组件 → 基于 `a-image` 封装
   - 日期选择器组件 → 基于 `a-date-picker` 封装
   - 气泡组件 → 基于 `a-popover` + `a-tooltip` 封装
   - 漫游引导组件 → 基于 `a-tour` 封装
   - 骨架屏组件 → 基于 `a-skeleton` 封装

2. **封装原则**
   - **继承性**：必须保留 Ant Design Vue 组件的所有原生 API 和功能
   - **扩展性**：在原有功能基础上增加新的 props、events、slots
   - **兼容性**：确保与 Ant Design Vue 的主题系统完全兼容
   - **一致性**：遵循 Ant Design Vue 的设计规范和交互模式

3. **技术实现要求**
   - 使用 Vue 3 Composition API 进行封装
   - 通过 `v-bind="$attrs"` 透传所有原生属性
   - 通过 `v-on="$listeners"` 透传所有原生事件
   - 保持 Ant Design Vue 组件的 ref 引用能力
   - 支持 Ant Design Vue 的全局配置和主题定制
   - **优先使用 VueUse 工具库解决常见开发问题**（拖拽、尺寸监听、交集观察、防抖节流等）
   - **文件上传组件例外：必须完全基于 `a-upload` 原生功能实现，不使用 VueUse**

## 需求

### 需求 1: 弹窗/对话框组件

**用户故事：** 作为开发者，我希望有一个基于 `a-modal` 封装的灵活弹窗组件，具有不同的尺寸和定位选项，以便我可以在适合各种用例的覆盖对话框中显示内容。

#### 技术实现约束

- **必须基于 `a-modal` 组件进行封装**
- **必须保留 `a-modal` 的所有原生 API**
- **必须支持 `a-modal` 的主题定制能力**
- **推荐使用 VueUse 工具库实现拖拽和调整尺寸功能**（如 `useDraggable`）

#### 验收标准

1. **基础封装要求**
   - 当封装组件时，系统必须基于 `a-modal` 组件实现
   - 当使用组件时，系统必须支持 `a-modal` 的所有原生属性和事件
   - 当主题定制时，系统必须与 Ant Design Vue 主题系统兼容

2. **功能扩展要求**
   - 当弹窗显示时，系统应将其居中显示在屏幕上
   - 当配置弹窗尺寸时，系统应支持小(400px)、正常(520px)、大(800px)、全屏四种尺寸选项
   - 当使用弹窗时，系统应暴露打开、关闭和配置的方法
   - 当弹窗打开时，系统应支持遮罩层点击关闭和 ESC 键关闭
   - 当弹窗内容过长时，系统应支持内容区域滚动和最大高度限制
   - 当需要确认操作时，系统应支持确认和取消按钮的自定义配置
   - 当弹窗嵌套时，系统应正确处理 z-index 层级关系
   - 当需要拖拽时，系统应支持弹窗拖拽移动功能（使用 VueUse `useDraggable`）
   - 当需要调整大小时，系统应支持弹窗边缘拖拽调整尺寸（使用 VueUse `useResizeObserver`）

### 需求 5: 文件上传组件

**用户故事：** 作为开发者，我希望有一个基于 `a-upload` 封装的功能丰富的文件上传组件，以便我可以处理具有各种约束和预览功能的文件上传。

#### 技术实现约束

- **必须基于 `a-upload` 组件进行封装**
- **必须保留 `a-upload` 的所有原生上传功能**
- **必须支持 `a-upload` 的文件列表管理和状态控制**
- **必须使用 `a-upload` 原生功能实现所有上传交互**（包括拖拽上传、文件选择等）

#### 验收标准

1. **基础封装要求**
   - 当封装组件时，系统必须基于 `a-upload` 组件实现
   - 当使用组件时，系统必须支持 `a-upload` 的所有原生属性和事件
   - 当文件管理时，系统必须使用 `a-upload` 的文件列表机制

2. **功能扩展要求**
   - 当上传文件时，系统应支持文件格式限制（图片、文档、视频等）
   - 当限制上传时，系统应支持文件大小(MB)和数量限制
   - 当上传多个文件时，系统应支持批量上传功能
   - 当处理下载时，系统应支持文件下载功能
   - 当点击上传时，系统应支持点击按钮选择文件
   - 当拖拽上传时，系统应支持拖拽文件到指定区域上传（使用 `a-upload` 的 `dragger` 模式）
   - 当粘贴上传时，系统应支持通过监听 paste 事件实现图片粘贴上传
   - 当上传图片时，系统应支持图片预览功能和缩略图展示

### 需求 6: 空状态组件

**用户故事：** 作为开发者，我希望有一个基于 `a-empty` 封装的可自定义空状态组件，以便在没有数据可用时提供有意义的反馈。

#### 技术实现约束

- **必须基于 `a-empty` 组件进行封装**
- **必须保留 `a-empty` 的所有原生功能和插槽**

#### 验收标准

1. **基础封装要求**
   - 当封装组件时，系统必须基于 `a-empty` 组件实现
   - 当使用组件时，系统必须支持 `a-empty` 的所有原生属性和插槽

2. **功能扩展要求**
   - 当显示空状态时，系统应支持自定义标题配置
   - 当显示内容时，系统应支持自定义内容/描述文本
   - 当添加视觉元素时，系统应支持自定义图片/图标显示
   - 当无数据时，系统应提供默认的无数据状态
   - 当网络错误时，系统应提供网络错误状态和重试按钮
   - 当权限不足时，系统应提供权限不足状态和申请链接
   - 当搜索无结果时，系统应提供搜索无结果状态

### 需求 7: 标签页组件

**用户故事：** 作为开发者，我希望有一个具有样式选项的灵活标签页组件，以便我可以在标签页界面中组织内容。

#### 验收标准

1. 当设置标签页样式时，系统应支持线条、卡片、按钮三种样式
2. 当设置标签位置时，系统应支持顶部、底部、左侧、右侧四个位置
3. 当设置标签大小时，系统应支持大、中、小三种尺寸
4. 当标签过多时，系统应支持标签滚动和省略显示
5. 当支持关闭时，系统应支持标签页关闭功能和关闭确认
6. 当支持新增时，系统应支持动态新增标签页

### 需求 8: 加载组件

**用户故事：** 作为开发者，我希望有一个可自定义的加载组件，以便我可以在整个应用程序中提供一致的加载反馈。

#### 验收标准

1. 当显示加载状态时，系统应支持转圈、点状、条状、波浪等多种样式
2. 当设置加载尺寸时，系统应支持小、中、大三种尺寸
3. 当加载文本时，系统应支持自定义加载提示文字
4. 当全局加载时，系统应支持全屏遮罩加载效果
5. 当局部加载时，系统应支持指定容器内的加载效果
6. 当按钮加载时，系统应支持按钮级别的加载状态
7. 当加载延迟时，系统应支持延迟显示避免闪烁(300ms)

### 需求 9: 消息/通知组件

**用户故事：** 作为开发者，我希望有一个具有不同状态和时间选项的消息组件，以便我可以为各种场景提供用户反馈。

#### 验收标准

1. 当显示消息时，系统应支持成功、错误、警告、信息四种状态类型
2. 当显示通知时，系统应支持可配置的显示持续时间(1-10 秒)
3. 当显示确认时，系统应支持确认对话框和操作回调
4. 当全局提示时，系统应支持顶部、中间、底部三种位置
5. 当通知消息时，系统应支持右上、右下、左上、左下四个角落
6. 当消息队列时，系统应支持消息队列管理和防重复显示

### 需求 10: 选择器组件

**用户故事：** 作为开发者，我希望有一个基于 `a-select` + `a-tree-select` 封装的具有高级功能的综合选择器组件，以便我可以创建各种选择界面。

#### 技术实现约束

- **必须基于 `a-select` 和 `a-tree-select` 组件进行封装**
- **必须保留两个组件的所有原生功能**
- **必须支持在不同模式间切换**

#### 验收标准

1. **基础封装要求**
   - 当封装组件时，系统必须基于 `a-select` 和 `a-tree-select` 组件实现
   - 当使用组件时，系统必须支持两个组件的所有原生属性和事件
   - 当切换模式时，系统必须能在普通选择和树形选择间切换

2. **功能扩展要求**
   - 当使用树形数据时，系统应支持树形选择器功能和级联选择
   - 当选择多个项目时，系统应支持多选模式和标签展示
   - 当查找选项时，系统应支持搜索/过滤功能和高亮显示
   - 当加载数据时，系统应支持本地和远程数据源
   - 当组织选项时，系统应支持选项分组和分组标题
   - 当远程搜索时，系统应支持防抖和加载状态(300ms 防抖)
   - 当选项过多时，系统应支持虚拟滚动优化性能(>100 项)
   - 当自定义显示时，系统应支持选项和标签的自定义渲染

### 需求 11: 级联选择器组件

**用户故事：** 作为开发者，我希望有一个级联选择组件，以便我可以创建分层选择界面。

#### 验收标准

1. 当使用本地数据时，系统应支持静态分层数据结构(树形 JSON)
2. 当加载远程数据时，系统应支持每个级别的动态数据加载
3. 当数据转换时，系统应支持平级数据转树形数据
4. 当单选模式时，系统应支持逐级选择直到叶子节点
5. 当多选模式时，系统应支持任意级别的多选操作
6. 当只选叶子时，系统应支持仅允许选择叶子节点
7. 当展示方式时，系统应支持下拉面板和弹窗两种展示方式
8. 当路径显示时，系统应支持选择路径的面包屑显示

### 需求 12: 下拉菜单组件

**用户故事：** 作为开发者，我希望有一个灵活的下拉菜单组件，以便我可以创建具有各种内容类型的自定义下拉界面。

#### 验收标准

1. 当鼠标触发时，系统应支持 hover、click 两种触发方式
2. 当右键菜单时，系统应支持 context menu 右键菜单
3. 当手动控制时，系统应支持编程方式打开关闭
4. 当定位下拉菜单时，系统应支持 12 个方向的定位选项
5. 当自动调整时，系统应支持边界检测和自动位置调整
6. 当自定义下拉菜单时，系统应支持自定义下拉面板内容
7. 当菜单项时，系统应支持图标、分割线、禁用状态

### 需求 14: 日期选择器组件

**用户故事：** 作为开发者，我希望有一个基于 `a-date-picker` 封装的可配置日期选择器组件，以便我可以创建具有各种格式和约束的日期选择界面。

#### 技术实现约束

- **必须基于 `a-date-picker`、`a-range-picker`、`a-time-picker` 组件进行封装**
- **必须保留所有原生日期选择功能**
- **必须支持 dayjs 日期处理库**

#### 验收标准

1. **基础封装要求**
   - 当封装组件时，系统必须基于 Ant Design Vue 的日期选择器组件实现
   - 当使用组件时，系统必须支持所有原生日期选择器的属性和事件
   - 当处理日期时，系统必须使用 dayjs 作为日期处理库

2. **功能扩展要求**
   - 当选择日期时，系统应支持单日期、日期范围和多日期选择
   - 当选择时间时，系统应支持日期时间、时间段选择
   - 当选择周期时，系统应支持周、月、季度、年的选择
   - 当格式化日期时，系统应支持自定义日期格式配置(YYYY-MM-DD 等)
   - 当显示格式时，系统应支持输入格式和显示格式分离
   - 当约束选择时，系统应支持最小/最大日期限制
   - 当禁用日期时，系统应支持特定日期或日期范围的禁用

### 需求 15: 气泡组件

**用户故事：** 作为开发者，我希望有一个灵活的气泡组件，以便在用户交互时显示提示信息、帮助文档或自定义内容。

#### 验收标准

1. 当鼠标悬停时，系统应支持 hover 触发显示气泡
2. 当点击触发时，系统应支持 click 触发显示气泡
3. 当聚焦时，系统应支持 focus/blur 触发气泡显示隐藏
4. 当手动控制时，系统应支持编程方式控制显示隐藏
5. 当设置位置时，系统应支持 12 个方向的定位选项（上下左右及各种组合）
6. 当边界检测时，系统应支持自动调整位置避免超出视口
7. 当显示文本时，系统应支持纯文本和富文本内容
8. 当自定义内容时，系统应支持 HTML 内容和 Vue 组件


## 技术规范

### 基础技术栈

- **Vue 3.x** (Composition API 优先)
- **TypeScript** (完整类型支持)
- **Ant Design Vue 4.x** (基础组件库，强制依赖)
- **VueUse** (Vue Composition 工具库，用于解决常见开发问题)
- **Vue Devtools** 支持
- **Tree Shaking** 友好 (支持按需引入)

### Ant Design Vue 封装规范

#### 强制性技术要求

1. **组件继承规范**
   - 所有组件必须通过 `defineComponent` 包装 Ant Design Vue 组件
   - 必须使用 `inheritAttrs: false` 并手动处理属性透传
   - 必须通过 `v-bind="$attrs"` 透传所有未声明的属性到底层 Ant Design Vue 组件
   - 必须保留对底层组件实例的引用能力

2. **API 兼容性要求**
   - 必须保留 Ant Design Vue 组件的所有原生 props
   - 必须保留 Ant Design Vue 组件的所有原生 events
   - 必须保留 Ant Design Vue 组件的所有原生 slots
   - 必须保留 Ant Design Vue 组件的所有原生 methods
   - 新增的 API 不能与原生 API 冲突

3. **主题系统兼容**
   - 必须完全兼容 Ant Design Vue 的 ConfigProvider
   - 必须支持 Ant Design Vue 的 Design Token 系统
   - 自定义样式必须通过 CSS Variables 或 Less 变量实现

4. **类型定义要求**
   - 必须继承 Ant Design Vue 组件的原生类型定义
   - 必须为新增功能提供完整的 TypeScript 类型
   - 必须确保类型推导的准确性和完整性

#### 代码实现规范

```typescript
// 组件封装示例模板
import { defineComponent, ref } from "vue";
import { Modal as AModal } from "ant-design-vue";
import type { ModalProps } from "ant-design-vue";

export interface CustomModalProps extends ModalProps {
  // 新增的自定义属性
  customProp?: string;
}

export default defineComponent({
  name: "CustomModal",
  inheritAttrs: false,
  props: {
    // 继承原生 props
    ...AModal.props,
    // 新增自定义 props
    customProp: String,
  },
  emits: [
    // 继承原生 events
    ...AModal.emits,
    // 新增自定义 events
    "customEvent",
  ],
  setup(props, { attrs, slots, emit, expose }) {
    const modalRef = ref();

    // 暴露原生组件实例
    expose({
      modalInstance: modalRef,
    });

    return () => (
      <AModal
        ref={modalRef}
        {...attrs}
        {...props}
        onOk={(e) => {
          // 自定义逻辑
          emit("ok", e);
        }}
      >
        {slots}
      </AModal>
    );
  },
});
```

### 性能要求

1. **Bundle 大小** - 单个组件 gzip 后 < 10KB (不包含 Ant Design Vue 依赖)
2. **首屏加载** - 支持按需加载和代码分割
3. **运行时性能** - 大数据场景下保持 60fps
4. **内存占用** - 避免内存泄漏，提供清理机制
5. **依赖管理** - Ant Design Vue 作为 peerDependency，避免重复打包

### 浏览器兼容性

- **Chrome** >= 88
- **Firefox** >= 85
- **Safari** >= 14
- **Edge** >= 88

## Ant Design Vue 集成要求总结

### 严格遵循的封装原则

1. **零破坏性原则**
   - 任何封装都不能破坏 Ant Design Vue 组件的原有功能
   - 必须保持 100% 的 API 向后兼容性
   - 所有原生功能必须完全可用

2. **透明封装原则**
   - 用户应该能够像使用原生 Ant Design Vue 组件一样使用封装组件
   - 所有原生属性、事件、插槽、方法都必须透明传递
   - 封装层不应该成为使用障碍

3. **增强不替代原则**
   - 封装的目的是增强功能，而不是替代原有功能
   - 新增功能应该是可选的，不影响基础使用
   - 保持与 Ant Design Vue 生态系统的完全兼容

### 禁止的实现方式

1. **禁止从零实现**
   - 严禁不基于 Ant Design Vue 组件而从零开始实现任何组件
   - 严禁复制 Ant Design Vue 组件代码进行修改

2. **禁止破坏性修改**
   - 严禁修改 Ant Design Vue 组件的原生 API
   - 严禁移除或重命名原生属性、事件、插槽
   - 严禁改变原生组件的默认行为

3. **禁止样式覆盖**
   - 严禁通过全局 CSS 覆盖 Ant Design Vue 组件样式
   - 严禁破坏 Ant Design Vue 的主题系统

### 验收标准

每个组件在完成后必须通过以下验收测试：

1. **原生功能测试**
   - 所有 Ant Design Vue 原生 demo 必须在封装组件上正常运行
   - 所有原生 API 必须按预期工作
   - 主题切换必须正常工作

2. **集成测试**
   - 与其他 Ant Design Vue 组件组合使用必须正常
   - 在 ConfigProvider 包裹下必须正常工作

3. **类型检查**
   - TypeScript 类型推导必须准确
   - 所有原生类型必须正确继承

**只有完全满足以上所有要求的组件才能被认为是合格的封装组件。**
